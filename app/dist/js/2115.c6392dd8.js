"use strict";(self["webpackChunkdoapp_crmtheme"]=self["webpackChunkdoapp_crmtheme"]||[]).push([[2115,2394],{82394:function(e,t,a){a.r(t);a(82801),a(61295);const s={computed:{getPresets(){return this.getKanbanSettings?.presets??[]},getActivePreset(){return this.getPresets.find((e=>!0===e.isActive))},getDetailLink(){return"?module="+this.module+"&offset="+this.offset+"&stamp="+this.stamp+"&record="+this.recordId+"&return_module="+this.module+"&parentTab="+this.parentTab+"&return_action=ListView&return_subAction=Kanban&action=DetailView"},getEditLink(){return"?module="+this.module+"&offset="+this.offset+"&stamp="+this.stamp+"&record="+this.recordId+"&return_module="+this.module+"&parentTab="+this.parentTab+"&return_action=ListView&return_subAction=Kanban&action=EditView"},pageData(){return this.$store.state.focus.data.pageData?this.$store.state.focus.data.pageData:{}},stamp(){return this.pageData.stamp?this.pageData.stamp:"0"},offset(){return this.pageData.offset?this.pageData.offset:"1"},parentTab(){return this.pageData.parentTab?this.pageData.parentTab:this.DOAPP.utils.translate("LBL_LINK_ALL")},module(){return this.$route.query.module},getKanbanSettings(){return this.$store.state.app.setting.kanban[this.module]},getSearchQuery(){return this.getKanbanSettings?this.getKanbanSettings.searchQuery:""}},methods:{async clearAll(e){await this.clearForm(),await this.applyForm(e),this.$store.commit("app/DEACTIVATE_KANBAN_PRESETS",this.module),window.$("#collapseKanbanSearchForm").collapse("hide"),window.$("#collapseKanbanPresetActions").collapse("hide")},clearForm(){this.$store.commit("focus/CLEAN_MODEL_PATH_VALUES",{path:"filters",row:"kanban",fields:this.$store.state.focus.data.filters.layout.advanced})},togglePresetActions(e){this.getSearchQuery||this.clearForm(e),window.$("#collapseKanbanSearchForm").collapse("hide"),window.$("#collapseKanbanPresetActions").collapse("toggle")},toggleFilter(){window.$("#collapseKanbanPresetActions").collapse("hide"),window.$("#collapseKanbanSearchForm").collapse("toggle")},async clearAndSearch(e){await this.clearForm(),await this.applyForm(e),this.$store.commit("app/DEACTIVATE_KANBAN_PRESETS",this.module)},async applyForm(e){let t=new FormData(e.target.form);await Object.keys(this.enumOptions).forEach((e=>{this.fetchKanbanColumnData(e,0,t)})),this.$store.dispatch("app/setKanbanFilterData"),this.$store.dispatch("app/setKanbanSearchQuery"),this.$store.dispatch("app/setSettings")},fetchKanbanColumnData(e,t="0",a=null){let s={module_name:this.$route.query.module,order:this.orderFieldName,offset:t,sortDirection:this.getKanbanSettings.sortDirection??"",status_field_name:this.fieldToEnum,status_field_value:e};this.$store.dispatch("focus/setKanbanData",{params:s,formData:a})},getSearchFormData(){let e=new FormData;if(e.append("searchFormTab","advanced_search"),this.getKanbanSettings){for(let t in this.getKanbanSettings.filters)this.getKanbanSettings.filters[t]&&e.append(t,this.getKanbanSettings.filters[t]);return e}return null},async openCreatePopup(e,t,a){let s=await this.getQuickCreateView(a),r=this.setQuickCreateParams(s,this.quickCreateParams),i={type:"quickCreate",header:{data:{title:"LBL_EMAIL_QUICK_CREATE",module:a},show:!0},body:{data:r,show:!0},footer:{data:{},show:!0}};i.body.data.module=a,i.body.data.record="",this.$store.dispatch("popup/setSize","xl"),this.$store.dispatch("popup/fill",i),this.$store.dispatch("popup/show")},async getQuickCreateView(e){let t={get:{module:"Home",VueAjax:1,method:"quickCreateView",arg:{targetModule:e}}},a=await this.$store.dispatch("ajaxGet",t);return a.data},setQuickCreateParams(e,t){let a=structuredClone(e);return t.forEach((e=>{a.beanData[e.name].value=e.value})),a},async chooseKanbanPreset(e){let t={id:e.target.id,module:this.module};await this.$store.dispatch("app/chooseKanbanPreset",t),await this.$store.dispatch("focus/setKanbanPresetValues",t),await this.applyForm(e),this.$store.commit("app/SET_ACTIVE_KANBAN_PRESET",t)}}};t["default"]=s},32115:function(e,t,a){a.r(t),a.d(t,{default:function(){return K}});var s=a(73396),r=a(87139),i=a(49242);const n={class:"collapse multi-collapse",id:"collapseKanbanPresetActions"},o={class:"card text-sm"},l={class:"card-body"},d={class:"row"},p={class:"form-group col-lg-6"},c={for:"saved_search_name"},u={class:"input-group"},h={class:"input-group-append"},m={class:"form-group col-lg-6"},_={for:"selected_preset_name"},b={class:"input-group"},g={id:"selected_preset_name",class:"form-control"},f={class:"input-group-append"},w=["disabled"],P=["disabled"];function A(e,t,a,A,v,S){return(0,s.wg)(),(0,s.iD)("div",n,[(0,s._)("div",o,[(0,s._)("div",l,[(0,s._)("div",d,[(0,s._)("div",p,[(0,s._)("label",c,(0,r.zw)(e.DOAPP.utils.translate("LBL_SAVE_SEARCH_AS","SavedSearch")),1),(0,s._)("div",u,[(0,s.wy)((0,s._)("input",{type:"text",id:"saved_search_name",name:"saved_search_name",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=e=>v.presetName=e)},null,512),[[i.nr,v.presetName]]),(0,s._)("div",h,[(0,s._)("button",{onClick:t[1]||(t[1]=(...e)=>S.savePreset&&S.savePreset(...e)),type:"button",class:"btn btn-primary",name:"saved_search_submit"},(0,r.zw)(e.DOAPP.utils.translate("LBL_SAVE_BUTTON_LABEL")),1)])])]),(0,s._)("div",m,[(0,s._)("label",_,(0,r.zw)(e.DOAPP.utils.translate("LBL_MODIFY_CURRENT_FILTER","SavedSearch")),1),(0,s._)("div",b,[(0,s._)("div",g,(0,r.zw)(e.getActivePreset?e.getActivePreset.name:""),1),(0,s._)("div",f,[(0,s._)("button",{type:"button",class:"btn btn-primary",onClick:t[2]||(t[2]=(...e)=>S.updatePreset&&S.updatePreset(...e)),name:"preset_update",id:"preset_update",disabled:!e.getActivePreset,form:"advanced_search_form"},(0,r.zw)(e.DOAPP.utils.translate("LBL_UPDATE")),9,w),(0,s._)("button",{type:"button",class:"btn btn-danger",onClick:t[3]||(t[3]=(...e)=>S.deletePreset&&S.deletePreset(...e)),name:"preset_delete",id:"preset_delete",disabled:!e.getActivePreset,form:"advanced_search_form"},(0,r.zw)(e.DOAPP.utils.translate("LBL_DELETE_BUTTON")),9,P)])])])])])])])}var v=a(82394),S={name:"daKanbanPresetActions",props:{fieldToEnum:{type:String,required:!0},enumOptions:{type:[Object,null],required:!0},orderFieldName:{type:String,required:!0}},mixins:[v["default"]],data(){return{presetName:""}},computed:{},methods:{savePreset(){this.$store.dispatch("app/saveKanbanPreset",this.presetName)},async updatePreset(e){await this.applyForm(e),this.$store.dispatch("app/updateKanbanPreset",this.module)},async deletePreset(e){this.$store.dispatch("app/deleteKanbanPreset",this.module),await this.clearAll(e),this.$store.dispatch("app/setSettings")}}},y=a(40089);const D=(0,y.Z)(S,[["render",A]]);var K=D}}]);