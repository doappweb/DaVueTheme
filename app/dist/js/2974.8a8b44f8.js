"use strict";(self["webpackChunkdoapp_crmtheme"]=self["webpackChunkdoapp_crmtheme"]||[]).push([[2974,8123,2394],{82394:function(t,e,a){a.r(e);a(82801),a(61295);const s={computed:{getPresets(){return this.getKanbanSettings?.presets??[]},getActivePreset(){return this.getPresets.find((t=>!0===t.isActive))},getDetailLink(){return"?module="+this.module+"&offset="+this.offset+"&stamp="+this.stamp+"&record="+this.recordId+"&return_module="+this.module+"&parentTab="+this.parentTab+"&return_action=ListView&return_subAction=Kanban&action=DetailView"},getEditLink(){return"?module="+this.module+"&offset="+this.offset+"&stamp="+this.stamp+"&record="+this.recordId+"&return_module="+this.module+"&parentTab="+this.parentTab+"&return_action=ListView&return_subAction=Kanban&action=EditView"},pageData(){return this.$store.state.focus.data.pageData?this.$store.state.focus.data.pageData:{}},stamp(){return this.pageData.stamp?this.pageData.stamp:"0"},offset(){return this.pageData.offset?this.pageData.offset:"1"},parentTab(){return this.pageData.parentTab?this.pageData.parentTab:this.DOAPP.utils.translate("LBL_LINK_ALL")},module(){return this.$route.query.module},getKanbanSettings(){return this.$store.state.app.setting.kanban[this.module]},getSearchQuery(){return this.getKanbanSettings?this.getKanbanSettings.searchQuery:""}},methods:{async clearAll(t){await this.clearForm(),await this.applyForm(t),this.$store.commit("app/DEACTIVATE_KANBAN_PRESETS",this.module),window.$("#collapseKanbanSearchForm").collapse("hide"),window.$("#collapseKanbanPresetActions").collapse("hide")},clearForm(){this.$store.commit("focus/CLEAN_MODEL_PATH_VALUES",{path:"filters",row:"kanban",fields:this.$store.state.focus.data.filters.layout.advanced})},togglePresetActions(t){this.getSearchQuery||this.clearForm(t),window.$("#collapseKanbanSearchForm").collapse("hide"),window.$("#collapseKanbanPresetActions").collapse("toggle")},toggleFilter(){window.$("#collapseKanbanPresetActions").collapse("hide"),window.$("#collapseKanbanSearchForm").collapse("toggle")},async clearAndSearch(t){await this.clearForm(),await this.applyForm(t),this.$store.commit("app/DEACTIVATE_KANBAN_PRESETS",this.module)},async applyForm(t){let e=new FormData(t.target.form);await Object.keys(this.enumOptions).forEach((t=>{this.fetchKanbanColumnData(t,0,e)})),this.$store.dispatch("app/setKanbanFilterData"),this.$store.dispatch("app/setKanbanSearchQuery"),this.$store.dispatch("app/setSettings")},fetchKanbanColumnData(t,e="0",a=null){let s={module_name:this.$route.query.module,order:this.orderFieldName,offset:e,sortDirection:this.getKanbanSettings.sortDirection??"",status_field_name:this.fieldToEnum,status_field_value:t};this.$store.dispatch("focus/setKanbanData",{params:s,formData:a})},getSearchFormData(){let t=new FormData;if(t.append("searchFormTab","advanced_search"),this.getKanbanSettings){for(let e in this.getKanbanSettings.filters)this.getKanbanSettings.filters[e]&&t.append(e,this.getKanbanSettings.filters[e]);return t}return null},async openCreatePopup(t,e,a){let s=await this.getQuickCreateView(a),r=this.setQuickCreateParams(s,this.quickCreateParams),i={type:"quickCreate",header:{data:{title:"LBL_EMAIL_QUICK_CREATE",module:a},show:!0},body:{data:r,show:!0},footer:{data:{},show:!0}};i.body.data.module=a,i.body.data.record="",this.$store.dispatch("popup/setSize","xl"),this.$store.dispatch("popup/fill",i),this.$store.dispatch("popup/show")},async getQuickCreateView(t){let e={get:{module:"Home",VueAjax:1,method:"quickCreateView",arg:{targetModule:t}}},a=await this.$store.dispatch("ajaxGet",e);return a.data},setQuickCreateParams(t,e){let a=structuredClone(t);return e.forEach((t=>{a.beanData[t.name].value=t.value})),a},async chooseKanbanPreset(t){let e={id:t.target.id,module:this.module};await this.$store.dispatch("app/chooseKanbanPreset",e),await this.$store.dispatch("focus/setKanbanPresetValues",e),await this.applyForm(t),this.$store.commit("app/SET_ACTIVE_KANBAN_PRESET",e)}}};e["default"]=s},22974:function(t,e,a){a.r(e),a.d(e,{default:function(){return k}});var s=a(73396),r=a(87139),i=a(49242);const n=t=>((0,s.dD)("data-v-0fa0758e"),t=t(),(0,s.Cn)(),t),o={class:"mb-2 mr-sm-1"},l={class:"btn-group w-100",role:"group"},c=["disabled"],d={class:"dropdown-menu"},u=["id"],h={class:"mb-2 mr-sm-1"},p={class:"btn-group w-100",role:"group"},m=n((()=>(0,s._)("i",{class:"bi bi-funnel"},null,-1))),g=[m],b={key:0,class:"px-2 w-100"},f={class:"ml-auto mb-2 d-flex flex-row"},_=["title"],w=n((()=>(0,s._)("i",{class:"far fa-save"},null,-1))),A=[w],y=["title"],S=n((()=>(0,s._)("i",{class:"bi bi-x-circle"},null,-1))),D=[S];function P(t,e,a,n,m,w){return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s._)("div",o,[(0,s._)("div",l,[(0,s._)("button",{type:"button",id:"my_filters_list",class:"btn btn-sm btn-outline-secondary dropdown-toggle","data-toggle":"dropdown","aria-expanded":"false",disabled:!t.getPresets.length},(0,r.zw)(t.getActivePreset?t.getActivePreset.name:t.DOAPP.utils.translate("LBL_SAVED_FILTER_SHORTCUT")),9,c),(0,s._)("div",d,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(t.getPresets,(a=>((0,s.wg)(),(0,s.iD)("button",{key:a.id,id:a.id,class:"dropdown-item",type:"button",form:"advanced_search_form",onClick:e[0]||(e[0]=(...e)=>t.chooseKanbanPreset&&t.chooseKanbanPreset(...e))},(0,r.zw)(a.name),9,u)))),128))])])]),(0,s._)("div",h,[(0,s._)("div",p,[(0,s._)("div",{id:"filter_button",onClick:e[2]||(e[2]=(...e)=>t.toggleFilter&&t.toggleFilter(...e)),class:(0,r.C_)(["d-flex flex-row btn btn-sm",{"btn-success":t.getSearchQuery,"btn-info":!t.getSearchQuery}]),role:"button"},[(0,s._)("div",{class:(0,r.C_)({"mx-auto":!t.getSearchQuery})},g,2),t.getSearchQuery?((0,s.wg)(),(0,s.iD)("div",b,[(0,s._)("i",null,(0,r.zw)(t.getSearchQuery),1)])):(0,s.kq)("",!0),t.getSearchQuery?((0,s.wg)(),(0,s.iD)("button",{key:1,class:"default_button",type:"button",form:"advanced_search_form",onClick:e[1]||(e[1]=(0,i.iM)(((...e)=>t.clearAndSearch&&t.clearAndSearch(...e)),["self"]))},"тип")):(0,s.kq)("",!0)],2)])]),(0,s._)("div",f,[(0,s._)("button",{class:"btn btn-sm btn-outline-success w-100 mr-2",type:"button",title:t.DOAPP.utils.translate("LBL_SAVING_LAYOUT"),onClick:e[3]||(e[3]=(...e)=>t.togglePresetActions&&t.togglePresetActions(...e)),form:"advanced_search_form"},A,8,_),(0,s._)("button",{class:"btn btn-sm btn-outline-danger w-100",type:"button",title:t.DOAPP.utils.translate("LBL_CLEARALL"),onClick:e[4]||(e[4]=(...e)=>t.clearAll&&t.clearAll(...e)),form:"advanced_search_form"},D,8,y)])],64)}var K=a(82394),C={name:"daKanbanFilterPanels",props:{enumOptions:{type:Object,required:!0},fieldToEnum:{type:String,required:!0},orderFieldName:{type:String,required:!0}},mixins:[K["default"]]},v=a(40089);const E=(0,v.Z)(C,[["render",P],["__scopeId","data-v-0fa0758e"]]);var k=E}}]);