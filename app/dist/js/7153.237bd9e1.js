"use strict";(self["webpackChunkdoapp_crmtheme"]=self["webpackChunkdoapp_crmtheme"]||[]).push([[7153,2394],{82394:function(t,e,a){a.r(e);a(82801),a(61295);const s={computed:{getPresets(){return this.getKanbanSettings?.presets??[]},getActivePreset(){return this.getPresets.find((t=>!0===t.isActive))},getDetailLink(){return"?module="+this.module+"&offset="+this.offset+"&stamp="+this.stamp+"&record="+this.recordId+"&return_module="+this.module+"&parentTab="+this.parentTab+"&return_action=ListView&return_subAction=Kanban&action=DetailView"},getEditLink(){return"?module="+this.module+"&offset="+this.offset+"&stamp="+this.stamp+"&record="+this.recordId+"&return_module="+this.module+"&parentTab="+this.parentTab+"&return_action=ListView&return_subAction=Kanban&action=EditView"},pageData(){return this.$store.state.focus.data.pageData?this.$store.state.focus.data.pageData:{}},stamp(){return this.pageData.stamp?this.pageData.stamp:"0"},offset(){return this.pageData.offset?this.pageData.offset:"1"},parentTab(){return this.pageData.parentTab?this.pageData.parentTab:this.DOAPP.utils.translate("LBL_LINK_ALL")},module(){return this.$route.query.module},getKanbanSettings(){return this.$store.state.app.setting.kanban[this.module]},getSearchQuery(){return this.getKanbanSettings?this.getKanbanSettings.searchQuery:""}},methods:{async clearAll(t){await this.clearForm(),await this.applyForm(t),this.$store.commit("app/DEACTIVATE_KANBAN_PRESETS",this.module),window.$("#collapseKanbanSearchForm").collapse("hide"),window.$("#collapseKanbanPresetActions").collapse("hide")},clearForm(){this.$store.commit("focus/CLEAN_MODEL_PATH_VALUES",{path:"filters",row:"kanban",fields:this.$store.state.focus.data.filters.layout.advanced})},togglePresetActions(t){this.getSearchQuery||this.clearForm(t),window.$("#collapseKanbanSearchForm").collapse("hide"),window.$("#collapseKanbanPresetActions").collapse("toggle")},toggleFilter(){window.$("#collapseKanbanPresetActions").collapse("hide"),window.$("#collapseKanbanSearchForm").collapse("toggle")},async clearAndSearch(t){await this.clearForm(),await this.applyForm(t),this.$store.commit("app/DEACTIVATE_KANBAN_PRESETS",this.module)},async applyForm(t){let e=new FormData(t.target.form);await Object.keys(this.enumOptions).forEach((t=>{this.fetchKanbanColumnData(t,0,e)})),this.$store.dispatch("app/setKanbanFilterData"),this.$store.dispatch("app/setKanbanSearchQuery"),this.$store.dispatch("app/setSettings")},fetchKanbanColumnData(t,e="0",a=null){let s={module_name:this.$route.query.module,order:this.orderFieldName,offset:e,sortDirection:this.getKanbanSettings.sortDirection??"",status_field_name:this.fieldToEnum,status_field_value:t};this.$store.dispatch("focus/setKanbanData",{params:s,formData:a})},getSearchFormData(){let t=new FormData;if(t.append("searchFormTab","advanced_search"),this.getKanbanSettings){for(let e in this.getKanbanSettings.filters)this.getKanbanSettings.filters[e]&&t.append(e,this.getKanbanSettings.filters[e]);return t}return null},async openCreatePopup(t,e,a){let s=await this.getQuickCreateView(a),r=this.setQuickCreateParams(s,this.quickCreateParams),i={type:"quickCreate",header:{data:{title:"LBL_EMAIL_QUICK_CREATE",module:a},show:!0},body:{data:r,show:!0},footer:{data:{},show:!0}};i.body.data.module=a,i.body.data.record="",this.$store.dispatch("popup/setSize","xl"),this.$store.dispatch("popup/fill",i),this.$store.dispatch("popup/show")},async getQuickCreateView(t){let e={get:{module:"Home",VueAjax:1,method:"quickCreateView",arg:{targetModule:t}}},a=await this.$store.dispatch("ajaxGet",e);return a.data},setQuickCreateParams(t,e){let a=structuredClone(t);return e.forEach((t=>{a.beanData[t.name].value=t.value})),a},async chooseKanbanPreset(t){let e={id:t.target.id,module:this.module};await this.$store.dispatch("app/chooseKanbanPreset",e),await this.$store.dispatch("focus/setKanbanPresetValues",e),await this.applyForm(t),this.$store.commit("app/SET_ACTIVE_KANBAN_PRESET",e)}}};e["default"]=s},7153:function(t,e,a){a.r(e),a.d(e,{default:function(){return _}});var s=a(73396),r=a(87139);const i={class:"collapse multi-collapse",id:"collapseKanbanSearchForm"},n={class:"card text-sm card-tabs"},o={class:"card-body"},l=["id"],d={name:"search_form",id:"advanced_search_form",class:"search_form"},c=(0,s._)("input",{type:"hidden",name:"searchFormTab",value:"advanced_search"},null,-1),u={class:"row"};function h(t,e,a,h,p,m){return(0,s.wg)(),(0,s.iD)("div",i,[(0,s._)("div",n,[(0,s._)("div",o,[(0,s._)("div",{id:t.module+"advanced_searchSearchForm",class:"tab-pane fade advanced show"},[(0,s._)("form",d,[c,(0,s._)("div",u,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(m.layout,((e,a)=>((0,s.wg)(),(0,s.j4)((0,s.LL)(m.fieldTemplate(m.fieldMetadata[e].type)),{key:a,name:e,module:t.module,metadata:m.fieldMetadata[e],values:m.kanbanValues,searchType:"kanban"},null,8,["name","module","metadata","values"])))),128))]),(0,s._)("button",{type:"button",class:"btn btn-primary mb-4 mr-1",form:"advanced_search_form",onClick:e[0]||(e[0]=(...t)=>m.applyHandler&&m.applyHandler(...t)),id:"search_form_submit"},(0,r.zw)(t.DOAPP.utils.translate("LBL_SEARCH_BUTTON_LABEL")),1),(0,s._)("button",{type:"button",class:"btn btn-danger mb-4 mr-1",onClick:e[1]||(e[1]=(...t)=>m.clearHandler&&m.clearHandler(...t)),id:"search_form_clear"},(0,r.zw)(t.DOAPP.utils.translate("LBL_CLEAR_BUTTON_LABEL")),1)])],8,l)])])])}var p=a(90601),m=a(82394),f={name:"daKanbanFilterBody",mixins:[m["default"]],created(){this.setSavedSearchValues()},props:{orderFieldName:{type:String,required:!0},fieldToEnum:{type:String,required:!0},enumOptions:{type:[Object,null],required:!0}},computed:{beanData(){return this.$store.state.focus.data.beanData},filters(){return this.$store.state.focus.data.filters},layout(){return this.filters.layout.advanced},fieldMetadata(){return this.filters.fieldMetadata.advanced},kanbanValues(){return this.filters.values.kanban},sortDirection:{get(){return this.getKanbanSettings.sortDirection},set(t){this.$store.commit("app/SET_KANBAN_SORT_DIRECTION",{sortDirection:t,module:this.module})}}},methods:{setSavedSearchValues(){if(this.getKanbanSettings&&this.getKanbanSettings.filters)for(let t in this.getKanbanSettings.filters)this.$store.commit("focus/UPDATE_MODEL_PATH_VALUE",{path:"filters",name:t,row:"kanban",value:this.getKanbanSettings.filters[t]})},clearHandler(){this.clearForm()},applyHandler(t){this.applyForm(t),this.$store.commit("app/DEACTIVATE_KANBAN_PRESETS",this.module)},fieldTemplate(t){return p["default"][t]}}},b=a(40089);const g=(0,b.Z)(f,[["render",h]]);var _=g}}]);