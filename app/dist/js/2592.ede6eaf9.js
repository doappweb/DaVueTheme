"use strict";(self["webpackChunkdoapp_crmtheme"]=self["webpackChunkdoapp_crmtheme"]||[]).push([[2592,7429,397,9112],{50397:function(e,t,s){s.r(t),t["default"]={"#007bff":"Primary","#6c757d":"Secondary","#17a2b8":"Info","#28a745":"Success","#ffc107":"Warning","#dc3545":"Danger","#6610f2":"Indigo","#3c8dbc":"Lightblue","#605ca8":"Purple","#e83e8c":"Pink","#f8f8f8":"Default"}},49112:function(e,t,s){s.r(t);s(82801),s(61295),s(57658);var a=s(50397),l=s(24239);const r={computed:{getColorScheme(){let e={};e=Object.assign({},this.calendarSettings.activityColors);for(let t in e)for(let s in e[t])"label"!==s&&(e[t][s]=this.getColorCodeToInput(e[t][s],t));return e},focusData(){return!0===this.isDashlet?this.$store.state.focus.data.viewData.panelsData[this.dashletId].viewData.data:this.$store.state.focus.data},isDashlet(){return this.$store.getters["app/getCalendarIsDashlet"]},dashletId(){return this.$store.getters["app/getCalendarDashletId"]},calendarSettings(){return this.DOAPP.utils.isEmpty(this.$store.state.app.setting.calendar.settings)&&this.$store.commit("app/SET_DEFAULT_SETTINGS",structuredClone(this.$store.getters["app/getDefaultCalendarSettings"])),this.$store.state.app.setting.calendar.settings},sharedUsers(){return this.$store.state.app.setting.calendar.sharedUsers},sharedUsersNames(){let e={};return this.sharedUsers.length&&this.availableSharedUsers&&this.sharedUsers.forEach((t=>{e[t]=this.availableSharedUsers[t]})),e},isEmptySharedUsers(){return!this.sharedUsers.length},availableSharedUsers(){let e={};return this.focusData&&this.focusData.availableSharedUsers&&(e=this.focusData.availableSharedUsers),e},isOnlyMineFlag(){return this.$store.state.app.setting.calendar.isOnlyMineFlag},savedCalendarPresets(){return this.$store.state.app.setting.saved_calendar_presets},hasSavedPresets(){return!!this.savedCalendarPresets.length},activePreset(){return this.savedCalendarPresets.find((e=>!0===e.isActive))},hasActivePreset(){return!!this.activePreset}},methods:{toggleFilter(){window.$("#collapseCalendarSettings").collapse("hide"),window.$("#collapsePresetActions").collapse("hide"),window.$("#collapseCalendarSelectUsers").collapse("toggle")},toggleSettings(){window.$("#collapseCalendarSelectUsers").collapse("hide"),window.$("#collapsePresetActions").collapse("hide"),window.$("#collapseCalendarSettings").collapse("toggle")},togglePresetActions(){window.$("#collapseCalendarSelectUsers").collapse("hide"),window.$("#collapseCalendarSettings").collapse("hide"),window.$("#collapsePresetActions").collapse("toggle")},async clearAll(e){window.$("#collapseCalendarSelectUsers").collapse("hide"),window.$("#collapsePresetActions").collapse("hide"),window.$("#collapseCalendarSettings").collapse("hide"),l["default"].commit("app/UPDATE_SHARED_USERS",[],{root:!0}),await this.setSharedUsers(),await this.cleanSettings(),await this.acceptSettings(e,!0)},toggleToDarkTheme(e){let t=[];t.push(document.querySelector(".dhx_cal_container")),t.push(document.querySelector(".dhx_cal_navline.dhx_cal_navline_flex")),t.push(document.querySelector(".dhx_cal_header")),t.push(document.querySelector(".dhx_cal_data")),t.push(document.querySelector(".dhx_scale_holder_now"));for(let s of t)s&&(e?s.classList.add("dark"):s.classList.remove("dark"))},async cleanSettings(){this.$store.commit("app/CLEAR_SETTINGS",structuredClone(this.$store.getters["app/getDefaultCalendarSettings"]))},async acceptSharedUsers(e,t){this.$store.commit("app/DEACTIVATE_CALENDAR_PRESETS"),await this.setSharedUsers(t),await this.setCalendarConfiguration(e)},async setCalendarConfiguration(e,t=!1){let s=new FormData(e.target.form),a=new FormData;if(t)a.append("day",l["default"].state.app.setting.calendar.settings.selectedDay),a.append("month",l["default"].state.app.setting.calendar.settings.selectedMonth),a.append("year",l["default"].state.app.setting.calendar.settings.selectedYear),a.append("view",l["default"].getters["app/getCalendarView"]());else for(let n of s.entries())n[1]=this.booleanTransform(n[1]),a.append(n[0],n[1]),"view"===n[0]&&(n[1]=l["default"].getters["app/getCalendarView"](),a.append(n[0],n[1]));let r={get:{module:"Calendar",action:"SaveSettings"},data:t?a:s};await this.$store.dispatch("focus/setCalendarSettings",r)},async acceptSettings(e,t=!1){this.$store.commit("app/DEACTIVATE_CALENDAR_PRESETS"),await this.setCalendarConfiguration(e,t)},setSharedUsers(e=[]){this.$store.dispatch("focus/setSharedUsers",e)},getColorCodeToInput(e,t){let s=e;return e.includes("#")||(s="#"+s),s=s.toLowerCase(),Object.hasOwn(a["default"],s)||(s=l["default"].getters["app/getDefaultCalendarSettings"].settings.activityColors[t].body),s},setColorScheme(e,t,s){let a=Object.assign({},this.getColorScheme);a[t][s]=e},setColors(){let e=this.calendarSettings.activityColors;for(let t in e){let s=".dhx_cal_event.event_"+t+" div, .dhx_cal_event_line.event_"+t,a=s+", .dhx_cal_event.dhx_cal_editor.event_"+t,l=".dhx_cal_event_clear.event_"+t,r=this.getSSClass(s.split(",")),n=this.getSSClass(a.split(",")),i=this.getSSClass(l.split(","));if(!(r&&n&&i))break;r.borderColor=e[t].border,n.backgroundColor=e[t].body,n.color=e[t].text,i.color=e[t].body}return!0},getSSClass(e){let t=!1;for(let s in document.styleSheets)for(let a in document.styleSheets[s].cssRules)if(document.styleSheets[s].cssRules[a].selectorText)for(let l of e){if(!document.styleSheets[s].cssRules[a].selectorText.includes(l))break;t=document.styleSheets[s].cssRules[a].style}return t},booleanTransform(e){return"on"===e||e}}};t["default"]=r},82592:function(e,t,s){s.r(t),s.d(t,{default:function(){return x}});var a=s(73396),l=s(87139),r=s(49242);const n=e=>((0,a.dD)("data-v-2d636b68"),e=e(),(0,a.Cn)(),e),i={class:"col-auto ml-auto"},o={class:"d-sm-flex"},c={class:"mb-2 mr-sm-1"},d={class:"btn-group w-100",role:"group"},h=["disabled"],u={class:"dropdown-menu"},p=["id","value","onClick"],g={class:"mb-2 mr-sm-1"},S={class:"btn-group w-100",role:"group"},m={key:0,class:"px-2 w-100"},f={key:0},_={class:"ml-auto mb-2 d-flex flex-row"},C=["title"],w=n((()=>(0,a._)("i",{class:"fas fa-cogs"},null,-1))),b=[w],D=["title"],v=n((()=>(0,a._)("i",{class:"far fa-save"},null,-1))),y=[v],A=["title"],P=n((()=>(0,a._)("i",{class:"bi bi-x-circle"},null,-1))),E=[P];function T(e,t,s,n,w,v){const P=(0,a.up)("CalendarDatepicker");return(0,a.wg)(),(0,a.iD)("div",i,[(0,a._)("div",o,[(0,a._)("div",c,[(0,a._)("div",d,[(0,a._)("button",{type:"button",id:"my_filters_list",class:"btn btn-sm btn-outline-secondary dropdown-toggle","data-toggle":"dropdown","aria-expanded":"false",disabled:!e.hasSavedPresets},(0,l.zw)(e.hasActivePreset?e.activePreset.name:e.DOAPP.utils.translate("LBL_SAVED_FILTER_SHORTCUT")),9,h),(0,a._)("div",u,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.savedCalendarPresets,((e,t)=>((0,a.wg)(),(0,a.iD)("button",{key:t,id:t,value:e.name,class:"dropdown-item",type:"button",form:"calendarSettings",onClick:t=>v.chooseSS(t,e.name)},(0,l.zw)(e.name),9,p)))),128))])])]),(0,a._)("div",g,[(0,a._)("div",S,[(0,a._)("div",{id:"filter_button",onClick:t[2]||(t[2]=(...t)=>e.toggleFilter&&e.toggleFilter(...t)),class:(0,l.C_)(["d-flex flex-row btn btn-sm",{"btn-success":v.showSearchQuery,"btn-info":!v.showSearchQuery}]),role:"button"},[(0,a._)("div",{class:(0,l.C_)({"mx-auto":!v.showSearchQuery})},[(0,a._)("i",{class:"bi bi-funnel",onClick:t[0]||(t[0]=(0,r.iM)(((...t)=>e.toggleFilter&&e.toggleFilter(...t)),["self"]))})],2),v.showSearchQuery?((0,a.wg)(),(0,a.iD)("div",m,[(0,a._)("i",null,[v.getSharedUsersNamesString?((0,a.wg)(),(0,a.iD)("b",f,(0,l.zw)(v.getSharedUsersNamesString),1)):(0,a.kq)("",!0)])])):(0,a.kq)("",!0),(0,a.wy)((0,a._)("button",{class:"default_button",type:"button",form:"calendarSettings",onClick:t[1]||(t[1]=(...e)=>v.clearAndSearch&&v.clearAndSearch(...e))},"тип ",512),[[r.F8,v.showSearchQuery]])],2)])]),(0,a._)("div",_,[(0,a.Wm)(P),(0,a._)("button",{class:"btn btn-sm btn-outline-warning w-100 mr-2",type:"button",title:this.DOAPP.utils.translate("LBL_COLUMN_CHOOSER"),onClick:t[3]||(t[3]=(...t)=>e.toggleSettings&&e.toggleSettings(...t))},b,8,C),(0,a._)("button",{class:"btn btn-sm btn-outline-success w-100 mr-2",type:"button",title:this.DOAPP.utils.translate("LBL_SAVING_LAYOUT"),onClick:t[4]||(t[4]=(...t)=>e.togglePresetActions&&e.togglePresetActions(...t))},y,8,D),(0,a._)("button",{class:"btn btn-sm btn-outline-danger w-100",type:"button",title:this.DOAPP.utils.translate("LBL_CLEARALL"),onClick:t[5]||(t[5]=(...t)=>e.clearAll&&e.clearAll(...t)),form:"calendarSettings"},E,8,A)])])])}var $=s(49112),U=s(57429),L={name:"CalendarActionMenu",components:{CalendarDatepicker:U["default"]},mixins:[$["default"]],computed:{getSharedUsersNamesString(){return Object.values(this.sharedUsersNames).join(", ")},showSearchQuery(){return!this.isOnlyMineFlag&&!this.isEmptySharedUsers}},methods:{async chooseSS(e,t){this.$store.commit("app/DEACTIVATE_CALENDAR_PRESETS"),this.$store.commit("app/CHOOSE_CALENDAR_PRESET",t),await this.setCalendarConfiguration(e),await this.$store.dispatch("app/setSettings",this.$store.state.app.setting)},async clearAndSearch(e){this.$store.commit("app/DEACTIVATE_CALENDAR_PRESETS"),this.$store.commit("app/UPDATE_IS_ONLY_MINE_FLAG",!0),this.$store.commit("app/UPDATE_SHARED_USERS"),this.setSharedUsers(),await this.setCalendarConfiguration(e,!0),await this.$store.dispatch("app/setSettings",this.$store.state.app.setting)}}},k=s(40089);const O=(0,k.Z)(L,[["render",T],["__scopeId","data-v-2d636b68"]]);var x=O},57429:function(e,t,s){s.r(t),s.d(t,{default:function(){return g}});var a=s(73396),l=s(49242);const r={class:"w-100 mr-2"},n=["onClick","title"],i=(0,a._)("i",{class:"bi bi-calendar3"},null,-1),o=[i];function c(e,t,s,i,c,d){const h=(0,a.up)("daDateTimePicker");return(0,a.wg)(),(0,a.iD)("div",r,[(0,a.Wm)(h,{title:e.DOAPP.utils.translate("LBL_MODULE_TITLE","Calendar"),name:"datepicker",state:"focus",date:d.getDate,"input-class-name":"d-none",enableTimePicker:!1,onChangeDate:d.setDate},{buttons:(0,a.w5)((({openMenu:t})=>[(0,a._)("button",{class:"btn btn-sm btn-outline-info w-100 mr-2",type:"button",onClick:(0,l.iM)(t,["prevent"]),title:e.DOAPP.utils.translate("LBL_MODULE_TITLE","Calendar")},o,8,n)])),_:1},8,["title","date","onChangeDate"])])}var d=s(79298),h={name:"CalendarDatepicker",components:{DaDateTimePicker:d["default"]},emits:["newSelectedDate"],computed:{getDate(){let e=this.getSelectedDate;if(e)return this.DOAPP.dateTime.formatDateTimeToVueCal(e)},getSelectedDate(){if(!this.$store.state.focus.data)return"";let e=this.$store.state.app.setting.calendar.settings,t={day:e.selectedDay,month:e.selectedMonth,year:e.selectedYear};return this.DOAPP.dateTime.userDateFormat().replace("d",t.day).replace("m",t.month).replace("Y",t.year)}},methods:{setDate(e){if(e){let t={selectedDay:String(this.DOAPP.dateTime.toDoubleDigit(e.getDate())),selectedMonth:String(this.DOAPP.dateTime.toDoubleDigit(e.getMonth()+1)),selectedYear:String(e.getFullYear()),view:this.$store.state.app.setting.calendar.settings.view};this.$store.dispatch("app/updateCalendarDate",t)}}}},u=s(40089);const p=(0,u.Z)(h,[["render",c]]);var g=p}}]);