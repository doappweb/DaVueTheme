"use strict";(self["webpackChunkdoapp_crmtheme"]=self["webpackChunkdoapp_crmtheme"]||[]).push([[3108,1288,397,9112],{50397:function(e,t,s){s.r(t),t["default"]={"#007bff":"Primary","#6c757d":"Secondary","#17a2b8":"Info","#28a745":"Success","#ffc107":"Warning","#dc3545":"Danger","#6610f2":"Indigo","#3c8dbc":"Lightblue","#605ca8":"Purple","#e83e8c":"Pink","#f8f8f8":"Default"}},49112:function(e,t,s){s.r(t);s(57658),s(82801),s(61295);var a=s(50397),l=s(24239);const r={computed:{getColorScheme(){let e={};e=Object.assign({},this.calendarSettings.activityColors);for(let t in e)for(let s in e[t])"label"!==s&&(e[t][s]=this.getColorCodeToInput(e[t][s],t));return e},focusData(){return!0===this.isDashlet?this.$store.state.focus.data.viewData.panelsData[this.dashletId].viewData.data:this.$store.state.focus.data},isDashlet(){return this.$store.getters["app/getCalendarIsDashlet"]},dashletId(){return this.$store.getters["app/getCalendarDashletId"]},calendarSettings(){return this.$store.state.app.setting.calendar.settings},sharedUsers(){return this.$store.state.app.setting.calendar.sharedUsers},sharedUsersNames(){let e={};return this.sharedUsers.length&&this.availableSharedUsers&&this.sharedUsers.forEach((t=>{e[t]=this.availableSharedUsers[t]})),e},isEmptySharedUsers(){return!this.sharedUsers.length},availableSharedUsers(){let e={};return this.focusData&&this.focusData.availableSharedUsers&&(e=this.focusData.availableSharedUsers),e},isOnlyMineFlag(){return this.$store.state.app.setting.calendar.isOnlyMineFlag},savedCalendarPresets(){return this.$store.state.app.setting.saved_calendar_presets},hasSavedPresets(){return!!this.savedCalendarPresets.length},activePreset(){return this.savedCalendarPresets.find((e=>!0===e.isActive))},hasActivePreset(){return!!this.activePreset}},methods:{toggleFilter(){window.$("#collapseCalendarSettings").collapse("hide"),window.$("#collapsePresetActions").collapse("hide"),window.$("#collapseCalendarSelectUsers").collapse("toggle")},toggleSettings(){window.$("#collapseCalendarSelectUsers").collapse("hide"),window.$("#collapsePresetActions").collapse("hide"),window.$("#collapseCalendarSettings").collapse("toggle")},togglePresetActions(){window.$("#collapseCalendarSelectUsers").collapse("hide"),window.$("#collapseCalendarSettings").collapse("hide"),window.$("#collapsePresetActions").collapse("toggle")},async clearAll(e){window.$("#collapseCalendarSelectUsers").collapse("hide"),window.$("#collapsePresetActions").collapse("hide"),window.$("#collapseCalendarSettings").collapse("hide"),l["default"].commit("app/UPDATE_SHARED_USERS",[],{root:!0}),await this.setSharedUsers(),await this.cleanSettings(),await this.acceptSettings(e,!0)},toggleToDarkTheme(e){let t=[];t.push(document.querySelector(".dhx_cal_container")),t.push(document.querySelector(".dhx_cal_navline.dhx_cal_navline_flex")),t.push(document.querySelector(".dhx_cal_header")),t.push(document.querySelector(".dhx_cal_data")),t.push(document.querySelector(".dhx_scale_holder_now"));for(let s of t)s&&(e?s.classList.add("dark"):s.classList.remove("dark"))},async cleanSettings(){this.$store.commit("app/CLEAR_SETTINGS",structuredClone(this.$store.getters["app/getDefaultCalendarSettings"]))},async acceptSharedUsers(e,t){this.$store.commit("app/DEACTIVATE_CALENDAR_PRESETS"),await this.setSharedUsers(t),await this.setCalendarConfiguration(e)},async setCalendarConfiguration(e,t=!1){let s=new FormData(e.target.form),a=new FormData;if(t)a.append("day",l["default"].state.app.setting.calendar.settings.selectedDay),a.append("month",l["default"].state.app.setting.calendar.settings.selectedMonth),a.append("year",l["default"].state.app.setting.calendar.settings.selectedYear),a.append("view",l["default"].getters["app/getCalendarView"]());else for(let d of s.entries())d[1]=this.booleanTransform(d[1]),a.append(d[0],d[1]),"view"===d[0]&&(d[1]=l["default"].getters["app/getCalendarView"](),a.append(d[0],d[1]));let r={get:{module:"Calendar",action:"SaveSettings"},data:t?a:s};await this.$store.dispatch("focus/setCalendarSettings",r)},async acceptSettings(e,t=!1){this.$store.commit("app/DEACTIVATE_CALENDAR_PRESETS"),await this.setCalendarConfiguration(e,t)},setSharedUsers(e=[]){this.$store.dispatch("focus/setSharedUsers",e)},getColorCodeToInput(e,t){let s=e;return e.includes("#")||(s="#"+s),s=s.toLowerCase(),Object.hasOwn(a["default"],s)||(s=l["default"].getters["app/getDefaultCalendarSettings"].activityColors[t].body),s},setColorScheme(e,t,s){let a=Object.assign({},this.getColorScheme);a[t][s]=e},setColors(){let e=this.calendarSettings.activityColors;for(let t in e){let s=".dhx_cal_event.event_"+t+" div, .dhx_cal_event_line.event_"+t,a=s+", .dhx_cal_event.dhx_cal_editor.event_"+t,l=".dhx_cal_event_clear.event_"+t,r=this.getSSClass(s.split(",")),d=this.getSSClass(a.split(",")),n=this.getSSClass(l.split(","));if(!(r&&d&&n))break;r.borderColor=e[t].border,d.backgroundColor=e[t].body,d.color=e[t].text,n.color=e[t].body}return!0},getSSClass(e){let t=!1;for(let s in document.styleSheets)for(let a in document.styleSheets[s].cssRules)if(document.styleSheets[s].cssRules[a].selectorText)for(let l of e){if(!document.styleSheets[s].cssRules[a].selectorText.includes(l))break;t=document.styleSheets[s].cssRules[a].style}return t},booleanTransform(e){return"on"===e||e}}};t["default"]=r},1288:function(e,t,s){s.r(t),s.d(t,{default:function(){return v}});var a=s(73396),l=s(87139),r=s(49242);const d=e=>((0,a.dD)("data-v-e0a273d6"),e=e(),(0,a.Cn)(),e),n={for:"shared_ids"},o={class:"d-flex flex-row flex-wrap"},i={class:"text-sm"},c=["onClick"],u={class:"dropdown-menu dropdown-menu-custom-scroll thin-scroll"},h=["id","disabled","onMousedown"],p=d((()=>(0,a._)("div",{class:"dropdown-divider"},null,-1)));function S(e,t,s,d,S,g){return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("label",n,(0,l.zw)(e.DOAPP.utils.translate("LBL_USERS","Calendar")),1),(0,a._)("div",{class:(0,l.C_)(["form-control",{disabled:e.isOnlyMineFlag}]),"data-toggle":"dropdown"},[(0,a._)("div",o,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.selectedSharedUsers,(t=>((0,a.wg)(),(0,a.iD)("div",{key:t,class:(0,l.C_)(["selected_panel",{disabled:e.isOnlyMineFlag}])},[(0,a._)("span",i,(0,l.zw)(e.availableSharedUsers[t]),1),(0,a._)("button",{class:"custom_delete_button",type:"button",onClick:(0,r.iM)((e=>g.removeValue(t)),["stop"])},"тип",8,c)],2)))),128))])],2),(0,a._)("div",u,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.availableSharedUsers,((e,t)=>((0,a.wg)(),(0,a.iD)(a.HY,{key:t},[(0,a._)("button",{id:"dropdown-item_"+t,tabindex:"-1",type:"button",class:(0,l.C_)(["dropdown-item text-sm",g.itemStatus(t).class]),disabled:g.itemStatus(t).disabled,onMousedown:e=>g.addValue(t)},(0,l.zw)(e),43,h),p],64)))),128))])])}var g=s(66183),m=s(49112),_={name:"CalendarMultiSelectField",extends:g["default"],props:{selectedSharedUsers:{type:Array,required:!0}},mixins:[m["default"]],emits:["addSelected","removeSelected"],computed:{value(){return this.$store.state.app.setting.calendar.sharedUsers}},methods:{itemStatus(e){for(let t of this.$props.selectedSharedUsers)if(e===t)return{class:"text-muted",disabled:!0};return{class:"",disabled:!1}},removeValue(e){this.$emit("removeSelected",e)},addValue(e){this.$emit("addSelected",e)}}},f=s(40089);const w=(0,f.Z)(_,[["render",S],["__scopeId","data-v-e0a273d6"]]);var v=w},53108:function(e,t,s){s.r(t),s.d(t,{default:function(){return C}});var a=s(73396),l=s(87139),r=s(49242);const d={class:"collapse multi-collapse",id:"collapseCalendarSelectUsers"},n={class:"card text-sm"},o={class:"card-header"},i={class:"card-body"},c={class:"row"},u={class:"form-group col-lg-6","data-type":"bool","data-field":"only_my_records"},h={class:"custom-control custom-switch"},p={class:"custom-control-label",for:"customSwitch"},S={class:"form-group col-lg-6"};function g(e,t,s,g,m,_){const f=(0,a.up)("CalendarMultiSelectField");return(0,a.wg)(),(0,a.iD)("div",d,[(0,a._)("div",n,[(0,a._)("div",o,[(0,a._)("h3",null,(0,l.zw)(e.DOAPP.utils.translate("LBL_EDIT_USERLIST","Calendar")),1)]),(0,a._)("div",i,[(0,a._)("div",c,[(0,a._)("div",u,[(0,a._)("div",h,[(0,a.wy)((0,a._)("input",{type:"checkbox",class:"custom-control-input",id:"customSwitch","true-value":"1","false-value":"0","onUpdate:modelValue":t[0]||(t[0]=e=>_.isOnlyMineValue=e)},null,512),[[r.e8,_.isOnlyMineValue]]),(0,a._)("label",p,(0,l.zw)(e.DOAPP.utils.translate("LBL_CURRENT_USER_FILTER")),1)])]),(0,a._)("div",S,[(0,a.Wm)(f,{selectedSharedUsers:m.selectedSharedUsers,onAddSelected:_.addSelectedHandler,onRemoveSelected:_.removeSelectedHandler},null,8,["selectedSharedUsers","onAddSelected","onRemoveSelected"])])]),(0,a._)("button",{type:"button",class:"btn btn-primary",style:{margin:"0.2em 0.2em 0 0"},form:"calendarSettings",onClick:t[1]||(t[1]=t=>e.acceptSharedUsers(t,this.selectedSharedUsers))},(0,l.zw)(e.DOAPP.utils.translate("LBL_APPLY_BUTTON","Calendar")),1),(0,a._)("button",{type:"button",class:"btn btn-danger",style:{margin:"0.2em 0.2em 0 0"},form:"calendarSettings",onClick:t[2]||(t[2]=(...e)=>_.cleanSelected&&_.cleanSelected(...e))},(0,l.zw)(e.DOAPP.utils.translate("LBL_CLEAR_BUTTON_LABEL")),1)])])])}s(82801),s(61295),s(57658);var m=s(1288),_=s(49112),f={name:"CalendarSelectUsers",components:{CalendarMultiSelectField:m["default"]},data(){return{user:this.$store.state.user.data,selectedSharedUsers:[]}},watch:{sharedUsers:{handler(e){this.selectedSharedUsers=structuredClone(e)},immediate:!0}},mixins:[_["default"]],computed:{isOnlyMineValue:{get(){return this.isOnlyMineFlag?"1":"0"},set(e){"1"===e?this.$store.commit("app/UPDATE_IS_ONLY_MINE_FLAG",!0):this.$store.commit("app/UPDATE_IS_ONLY_MINE_FLAG",!1)}}},methods:{addSelectedHandler(e){this.selectedSharedUsers.push(e)},removeSelectedHandler(e){this.selectedSharedUsers=this.selectedSharedUsers.filter((t=>t!==e))},cleanSelected(){this.selectedSharedUsers=[]}}},w=s(40089);const v=(0,w.Z)(f,[["render",g]]);var C=v}}]);