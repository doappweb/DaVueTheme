"use strict";(self["webpackChunkdoapp_crmtheme"]=self["webpackChunkdoapp_crmtheme"]||[]).push([[1656,1486],{31486:function(e,t,i){i.r(t),i.d(t,{default:function(){return h}});var a=i(73396),n=i(87139);const l=["data-type","data-field"],s={class:"text-muted font-weight-bold"},d={key:0,class:"d-block"},r={key:1,class:"d-block"};function o(e,t,i,o,u,c){return(0,a.wg)(),(0,a.iD)("div",{class:(0,n.C_)(["mb-3",c.widthClass]),"data-type":c.fieldDef.type,"data-field":i.name},[(0,a._)("span",s,[(0,a.Uk)((0,n.zw)(e.DOAPP.utils.translate(c.resolveFieldLBL(i.metadata.field.label),i.module))+" ",1),c.inlineEditSet()&&!u.inlineEdit.run?((0,a.wg)(),(0,a.iD)("i",{key:0,class:"bi bi-pencil-square ml-2",onClick:t[0]||(t[0]=(...e)=>c.inlineEditInitBtn&&c.inlineEditInitBtn(...e)),role:"button"})):(0,a.kq)("",!0),u.inlineEdit.run?((0,a.wg)(),(0,a.iD)("i",{key:1,class:"bi bi-check-circle-fill text-success ml-2",onClick:t[1]||(t[1]=(...e)=>c.inlineEditSaveBtn&&c.inlineEditSaveBtn(...e)),role:"button"})):(0,a.kq)("",!0),u.inlineEdit.run?((0,a.wg)(),(0,a.iD)("i",{key:2,class:"bi bi-x-circle-fill text-danger ml-2",onClick:t[2]||(t[2]=(...e)=>c.inlineEditCancelBtn&&c.inlineEditCancelBtn(...e)),role:"button"})):(0,a.kq)("",!0)]),u.inlineEdit.run?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("span",d,(0,n.zw)(c.value),1)),u.inlineEdit.run||c.value?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("span",r,"—")),u.inlineEdit.run?((0,a.wg)(),(0,a.j4)((0,a.LL)(c.inlineEditSet()),{key:2,ref:"inlineEdit",name:i.name,module:i.module,record:i.record,metadata:i.metadata,beanData:i.beanData},null,8,["name","module","record","metadata","beanData"])):(0,a.kq)("",!0)],10,l)}var u=i(85697),c={name:"FieldName",widgetCols:1,props:{name:{type:String},module:{type:String},record:{type:String},metadata:{type:Object},beanData:{type:Object},sideBlock:{type:Boolean},accessEdit:{type:Boolean}},data(){return{inlineEdit:{tpl:!1,run:!1,temp:{}}}},computed:{fieldDef(){return this.beanData[this.name]},displayParams(){let e={};return Object.hasOwn(this.metadata.field,"displayParams")&&(e=this.metadata.field.displayParams),e},widthClass(){let e=this.$options.widgetCols;this.sideBlock&&(e=2*this.$options.widgetCols);let t=6*e,i=3*e;return t>=12&&(t=12),i>=12&&(i=12),"col-md-"+t+" col-lg-"+i},value(){return this.DOAPP.utils.htmlDecode(this.fieldDef.value)}},methods:{inlineEditSet(){return!(!this.accessEdit||!1===this.fieldDef.inline_edit)&&u["default"][this.inlineEdit.tpl]},inlineEditInitBtn(){this.inlineEdit.run=!0;let e=setInterval((()=>{this.$refs.inlineEdit&&(clearInterval(e),this.inlineEdit.temp=this.$refs.inlineEdit.localStorage.temp)}),50);setTimeout((()=>{clearInterval(e)}),1e3)},inlineEditCancelBtn(){let e=this.inlineEdit.temp;for(let t in e)this.$store.dispatch("focus/updateModelValue",{name:t,value:e[t]});this.inlineEdit.run=!1,this.inlineEdit.temp={}},inlineEditSaveBtn(){if(this.$refs.inlineEdit.validation.error)return void console.log("validation error");let e=this.$refs.inlineEdit.inlineEditForm(),t={module:"Home",action:"saveHTMLField",current_module:this.module,id:this.record,view:"DetailView",to_pdf:!0};for(let i of e.entries())t["field"]=i[0],t["value"]=i[1],i[1]!==this.inlineEdit.temp[i[0]]&&this.$store.dispatch("ajaxGet",{get:t});this.inlineEdit.run=!1,this.inlineEdit.temp={}},resolveFieldLBL(e){return void 0===e&&(e=this.fieldDef.vname),e}}},p=i(40089);const m=(0,p.Z)(c,[["render",o]]);var h=m},71656:function(e,t,i){i.r(t),i.d(t,{default:function(){return E}});var a=i(73396),n=i(87139);const l=["data-type","data-field"],s={class:"text-muted font-weight-bold"},d={class:"pt-1"},r={key:0,class:"d-block"},o={key:1};function u(e,t,i,u,c,p){return(0,a.wg)(),(0,a.iD)("div",{class:(0,n.C_)(["mb-3",e.widthClass]),"data-type":e.fieldDef.type,"data-field":e.name},[(0,a._)("span",s,[(0,a.Uk)((0,n.zw)(e.DOAPP.utils.translate(e.resolveFieldLBL(e.metadata.field.label),e.module))+" ",1),e.inlineEditSet()&&!c.inlineEdit.run?((0,a.wg)(),(0,a.iD)("i",{key:0,class:"bi bi-pencil-square ml-2",onClick:t[0]||(t[0]=(...t)=>e.inlineEditInitBtn&&e.inlineEditInitBtn(...t)),role:"button"})):(0,a.kq)("",!0),c.inlineEdit.run?((0,a.wg)(),(0,a.iD)("i",{key:1,class:"bi bi-check-circle-fill text-success ml-2",onClick:t[1]||(t[1]=(...t)=>e.inlineEditSaveBtn&&e.inlineEditSaveBtn(...t)),role:"button"})):(0,a.kq)("",!0),c.inlineEdit.run?((0,a.wg)(),(0,a.iD)("i",{key:2,class:"bi bi-x-circle-fill text-danger ml-2",onClick:t[2]||(t[2]=(...t)=>e.inlineEditCancelBtn&&e.inlineEditCancelBtn(...t)),role:"button"})):(0,a.kq)("",!0)]),c.inlineEdit.run?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a._)("div",d,[p.value?((0,a.wg)(),(0,a.iD)("ul",o,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(p.value,((e,t)=>((0,a.wg)(),(0,a.iD)("li",{key:t},(0,n.zw)(e),1)))),128))])):((0,a.wg)(),(0,a.iD)("span",r,"—"))]),"Held"!==this.beanData.status.value?((0,a.wg)(),(0,a.iD)("button",{key:0,type:"button",class:"btn btn-success",onClick:t[3]||(t[3]=e=>p.popupHandler())},(0,n.zw)(e.DOAPP.utils.translate("LBL_RESCHEDULE",e.module)),1)):(0,a.kq)("",!0)],64)),c.inlineEdit.run?((0,a.wg)(),(0,a.j4)((0,a.LL)(e.inlineEditSet()),{key:1,ref:"inlineEdit",name:e.name,module:e.module,record:e.record,metadata:e.metadata,beanData:e.beanData},null,8,["name","module","record","metadata","beanData"])):(0,a.kq)("",!0)],10,l)}i(57658);var c=i(31486),p={name:"RescheduleHistoryField",extends:c["default"],widgetCols:2,data(){return{inlineEdit:{tpl:!1,run:!1,temp:{}}}},computed:{value(){if(!this.fieldDef.value.length)return"";let e=[];return this.fieldDef.value.forEach((t=>{e.push(t.replaceAll("&#160"," "))})),e}},methods:{popupHandler(){this.$store.dispatch("popup/setSize","sm"),this.$store.dispatch("popup/fill",{type:"RescheduleHistory",header:{show:!0,data:{title:"LBL_RESCHEDULE_LABEL"}},body:{show:!0,data:{fields:{date_start:this.beanData.date_start,reason:{name:"reason",type:"enum",options:this.$store.state.app.list_strings.call_reschedule_dom,value:""}},metadata:{date_start:{field:{label:"LBL_RESCHEDULE_DATE"}},reason:{field:{label:"LBL_RESCHEDULE_REASON"}}},beanData:{date_start:this.beanData,reason:{reason:{name:"reason",type:"enum",options:this.$store.state.app.list_strings.call_reschedule_dom,value:""}}},error:{date_start:{id:"error1",msg:this.DOAPP.utils.translate("LBL_RESCHEDULE_ERROR1",this.module)},reason:{id:"error2",msg:this.DOAPP.utils.translate("LBL_RESCHEDULE_ERROR2",this.module)}},module:this.module,record:this.record}},footer:{show:!0,data:{onConfirm:this.confirmMethod}}}),this.$store.dispatch("popup/show")},async confirmMethod(){const e=document.querySelector("form");let t=new FormData(e),i={};for(let a of t.entries())i[a[0]]=a[1];if(this.validation(i)){let e=new FormData;e.append("use_real_names","off"),e.append("format",this.$store.state.user.data.userTimeFormat),e.append("dateformat",this.$store.state.user.data.userDateFormat),e.append("user",this.$store.state.user.data.username),e.append("call_id",this.record),e.append("reason",i["reason"]);let t=i["date_start"].split(" "),a=t[1].split(":");e.append("date",t[0]),e.append("date_start_hours",a[0]),e.append("date_start_minutes",a[1]),e.append("module",this.module),e.append("action","Reschedule"),await this.$store.dispatch("ajaxPost",{data:e,sanitize:!1}),this.$store.dispatch("popup/hide"),await this.$store.dispatch("focus/getFocus",{get:this.$route.query,sanitize:!0})}},validation(e){document.getElementById("error1").style.display="none",document.getElementById("error2").style.display="none";let t=!0;return e.date_start||(document.getElementById("error1").style.display="",t=!1),e.reason||(document.getElementById("error2").style.display="",t=!1),t}}},m=i(40089);const h=(0,m.Z)(p,[["render",u]]);var E=h}}]);